<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçµæ ‘æ´ - åŒ¿åå€¾è¯‰ä¸å€¾å¬</title>
    <script src="./å¿ƒçµæ ‘æ´ - åŒ¿åå€¾è¯‰ä¸å€¾å¬_files/saved_resource"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/v4-shims.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B7355',
                        secondary: '#D4B896',
                        accent: '#F5E6D3',
                        warm: '#FFF8DC',
                        earth: '#A0522D',
                        flower: '#4ADE80', // æŸ”å’Œçš„ç»¿è‰²ä½œä¸ºé²œèŠ±é¢œè‰²
                        hugCount: '#3B82F6', // è“è‰²ä½œä¸ºæ‹¥æŠ±ç»Ÿè®¡é¢œè‰²
                        error: '#EF4444', // çº¢è‰²ä½œä¸ºé”™è¯¯æç¤ºé¢œè‰²
                        success: '#10B981' // ç»¿è‰²ä½œä¸ºæˆåŠŸæç¤ºé¢œè‰²
                    },
                    fontFamily: {
                        'handwriting': ['Georgia', 'serif'],
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
            .letter-fall {
                animation: letterFall 8s infinite linear;
            }
            .treehole-enter {
                animation: treeholeEnter 2s ease-in-out forwards;
            }
            .float-animation {
                animation: float 3s ease-in-out infinite;
            }
            .pulse-glow {
                animation: pulseGlow 2s ease-in-out infinite alternate;
            }
            .fade-in {
                animation: fadeIn 0.5s ease-in-out forwards;
            }
            .slide-up {
                animation: slideUp 0.6s ease-out forwards;
            }
            .treehole-zoom {
                animation: treeholeZoom 1.5s ease-in-out forwards;
            }
            .darken-background {
                animation: darkenBackground 1s ease-in-out forwards;
            }
            .darken-reverse {
                animation: darkenReverse 1s ease-in-out forwards;
            }
            .error-shake {
                animation: errorShake 0.5s ease-in-out forwards;
            }
        }
        
        @keyframes letterFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes treeholeEnter {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(0.8);
                opacity: 0.7;
            }
            100% {
                transform: scale(10);
                opacity: 0;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes pulseGlow {
            0% {
                box-shadow: 0 0 20px rgba(245, 230, 211, 0.5);
            }
            100% {
                box-shadow: 0 0 40px rgba(245, 230, 211, 0.8);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes treeholeZoom {
            0% {
                transform: scale(0.3) translate(-50%, -50%);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) translate(-45%, -45%);
                opacity: 0.9;
            }
            100% {
                transform: scale(1) translate(-50%, -50%);
                opacity: 1;
            }
        }
        
        @keyframes darkenBackground {
            from {
                background-color: rgba(0, 0, 0, 0);
            }
            to {
                background-color: rgba(0, 0, 0, 0.7);
            }
        }
        
        @keyframes darkenReverse {
            from {
                background-color: rgba(0, 0, 0, 0.7);
            }
            to {
                background-color: rgba(0, 0, 0, 0);
            }
        }
        
        @keyframes errorShake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }
        
        .treehole-bg {
            background-image: url('https://aka.doubaocdn.com/s/7s861w0Z9s');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .letter-card {
            transition: all 0.3s ease;
        }
        
        .letter-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
        
        .user-info {
            background: rgba(139, 115, 85, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .tree-click-area {
            position: absolute;
            width: 40%;
            height: 60%;
            top: 20%;
            left: 30%;
            cursor: pointer;
            z-index: 20;
        }
        
        .treehole-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            opacity: 0;
            pointer-events: none;
        }
        
        .darken-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            z-index: 15;
            pointer-events: none;
        }
        
        .hug-notification {
            animation: hugNotification 4s ease-in-out forwards;
        }
        
        @keyframes hugNotification {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            10% {
                transform: translateX(0);
                opacity: 1;
            }
            90% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-100%);
                opacity: 0;
            }
        }
        
        .stat-notification {
            animation: statNotification 5s ease-in-out forwards;
        }
        
        @keyframes statNotification {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            10% {
                transform: translateY(0);
                opacity: 1;
            }
            90% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100%);
                opacity: 0;
            }
        }
        
        .hug-badge {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hug-badge:hover {
            transform: scale(1.1);
            background-color: #dc2626 !important;
        }
        
        .notification {
            transition: all 0.3s ease;
        }
        
        .notification:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.right-4{right:1rem}.top-4{top:1rem}.bottom-4{bottom:1rem}.left-4{left:1rem}.top-12{top:3rem}.top-24{top:6rem}.top-36{top:9rem}.z-10{z-index:10}.z-50{z-index:50}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-16{margin-bottom:4rem}.mb-2{margin-bottom:0.5rem}.mb-20{margin-bottom:5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mr-2{margin-right:0.5rem}.mt-12{margin-top:3rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mb-12{margin-bottom:3rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-24{height:6rem}.h-48{height:12rem}.min-h-screen{min-height:100vh}.w-16{width:4rem}.w-24{width:6rem}.w-48{width:12rem}.w-full{width:100%}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-md{max-width:28rem}.max-w-2xl{max-width:42rem}.max-w-6xl{max-width:72rem}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-12{gap:3rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-hidden{overflow-x:hidden}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.border{border-width:1px}.border-4{border-width:4px}.border-secondary{--tw-border-opacity:1;border-color:rgb(212 184 150 / var(--tw-border-opacity, 1))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-earth{--tw-bg-opacity:1;background-color:rgb(160 82 45 / var(--tw-bg-opacity, 1))}.bg-error{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-primary{--tw-bg-opacity:1;background-color:rgb(139 115 85 / var(--tw-bg-opacity, 1))}.bg-secondary{--tw-bg-opacity:1;background-color:rgb(212 184 150 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-accent{--tw-bg-opacity:1;background-color:rgb(245 230 211 / var(--tw-bg-opacity, 1))}.bg-flower{--tw-bg-opacity:1;background-color:rgb(74 222 128 / var(--tw-bg-opacity, 1))}.bg-hugCount{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-rose-600{--tw-bg-opacity:1;background-color:rgb(225 29 72 / var(--tw-bg-opacity, 1))}.bg-opacity-20{--tw-bg-opacity:0.2}.bg-opacity-50{--tw-bg-opacity:0.5}.bg-gradient-to-b{background-image:linear-gradient(to bottom, var(--tw-gradient-stops))}.from-accent{--tw-gradient-from:#F5E6D3 var(--tw-gradient-from-position);--tw-gradient-to:rgb(245 230 211 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-earth{--tw-gradient-from:#A0522D var(--tw-gradient-from-position);--tw-gradient-to:rgb(160 82 45 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-warm{--tw-gradient-to:#FFF8DC var(--tw-gradient-to-position)}.to-primary{--tw-gradient-to:#8B7355 var(--tw-gradient-to-position)}.p-8{padding:2rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-16{padding-top:4rem;padding-bottom:4rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-8{padding-left:2rem;padding-right:2rem}.text-center{text-align:center}.font-handwriting{font-family:Georgia, serif}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-medium{font-weight:500}.leading-relaxed{line-height:1.625}.text-accent{--tw-text-opacity:1;color:rgb(245 230 211 / var(--tw-text-opacity, 1))}.text-earth{--tw-text-opacity:1;color:rgb(160 82 45 / var(--tw-text-opacity, 1))}.text-error{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-primary{--tw-text-opacity:1;color:rgb(139 115 85 / var(--tw-text-opacity, 1))}.text-warm{--tw-text-opacity:1;color:rgb(255 248 220 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.text-shadow {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }.float-animation {
                animation: float 3s ease-in-out infinite;
            }.pulse-glow {
                animation: pulseGlow 2s ease-in-out infinite alternate;
            }.fade-in {
                animation: fadeIn 0.5s ease-in-out forwards;
            }.slide-up {
                animation: slideUp 0.6s ease-out forwards;
            }
        
        @keyframes letterFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes treeholeEnter {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(0.8);
                opacity: 0.7;
            }
            100% {
                transform: scale(10);
                opacity: 0;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes pulseGlow {
            0% {
                box-shadow: 0 0 20px rgba(245, 230, 211, 0.5);
            }
            100% {
                box-shadow: 0 0 40px rgba(245, 230, 211, 0.8);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes treeholeZoom {
            0% {
                transform: scale(0.3) translate(-50%, -50%);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) translate(-45%, -45%);
                opacity: 0.9;
            }
            100% {
                transform: scale(1) translate(-50%, -50%);
                opacity: 1;
            }
        }
        
        @keyframes darkenBackground {
            from {
                background-color: rgba(0, 0, 0, 0);
            }
            to {
                background-color: rgba(0, 0, 0, 0.7);
            }
        }
        
        @keyframes darkenReverse {
            from {
                background-color: rgba(0, 0, 0, 0.7);
            }
            to {
                background-color: rgba(0, 0, 0, 0);
            }
        }
        
        @keyframes errorShake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }
        
        .treehole-bg {
            background-image: url('https://aka.doubaocdn.com/s/7s861w0Z9s');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .letter-card {
            transition: all 0.3s ease;
        }
        
        .letter-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .modal-backdrop {
            -webkit-backdrop-filter: blur(5px);
                    backdrop-filter: blur(5px);
        }
        
        .user-info {
            background: rgba(139, 115, 85, 0.9);
            -webkit-backdrop-filter: blur(10px);
                    backdrop-filter: blur(10px);
        }
        
        .tree-click-area {
            position: absolute;
            width: 40%;
            height: 60%;
            top: 20%;
            left: 30%;
            cursor: pointer;
            z-index: 20;
        }
        
        .treehole-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            opacity: 0;
            pointer-events: none;
        }
        
        .darken-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            z-index: 15;
            pointer-events: none;
        }
        
        .hug-notification {
            animation: hugNotification 4s ease-in-out forwards;
        }
        
        @keyframes hugNotification {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            10% {
                transform: translateX(0);
                opacity: 1;
            }
            90% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-100%);
                opacity: 0;
            }
        }
        
        .stat-notification {
            animation: statNotification 5s ease-in-out forwards;
        }
        
        @keyframes statNotification {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            10% {
                transform: translateY(0);
                opacity: 1;
            }
            90% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100%);
                opacity: 0;
            }
        }
        
        .hug-badge {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hug-badge:hover {
            transform: scale(1.1);
            background-color: #dc2626 !important;
        }
        
        .notification {
            transition: all 0.3s ease;
        }
        
        .notification:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .hover\:bg-earth:hover{--tw-bg-opacity:1;background-color:rgb(160 82 45 / var(--tw-bg-opacity, 1))}
        
        .hover\:bg-primary:hover{--tw-bg-opacity:1;background-color:rgb(139 115 85 / var(--tw-bg-opacity, 1))}
        
        .hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}
        
        .hover\:bg-accent:hover{--tw-bg-opacity:1;background-color:rgb(245 230 211 / var(--tw-bg-opacity, 1))}
        
        .hover\:bg-secondary:hover{--tw-bg-opacity:1;background-color:rgb(212 184 150 / var(--tw-bg-opacity, 1))}
        
        .hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}
        
        .hover\:opacity-100:hover{opacity:1}
        
        .hover\:shadow-2xl:hover{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}
        
        .focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}
        
        .focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}
        
        .focus\:ring-primary:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(139 115 85 / var(--tw-ring-opacity, 1))}
        
        .disabled\:cursor-not-allowed:disabled{cursor:not-allowed}
        
        .disabled\:opacity-50:disabled{opacity:0.5}
        
        @media (min-width: 768px){.md\:h-64{height:16rem}.md\:w-64{width:16rem}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-6xl{font-size:3.75rem;line-height:1}.md\:text-8xl{font-size:6rem;line-height:1}}
        
        @media (min-width: 1024px){.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}
    </style></head>
<body class="min-h-screen overflow-x-hidden">
    <!-- é¦–é¡µ - æ ‘æ´åœºæ™¯ -->
    <div id="homePage" class="treehole-bg min-h-screen flex items-center justify-center relative">
        <div class="absolute inset-0 bg-black bg-opacity-20"></div>
        
        <!-- å¯ç‚¹å‡»çš„æ ‘åŒºåŸŸ -->
        <div id="treeClickArea" class="tree-click-area">
            <div class="absolute inset-0 flex items-center justify-center">
                <p class="text-warm text-xl md:text-2xl text-shadow opacity-0 hover:opacity-100 transition-opacity duration-300">
                    ç‚¹å‡»å¤§æ ‘ï¼Œå¼€å§‹å€¾è¯‰
                </p>
            </div>
        </div>
        
        <!-- æ”¾å¤§çš„æ ‘æ´æŒ‰é’® -->
        <div id="treeholeButton" class="treehole-button">
            <div class="w-48 h-48 md:w-64 md:h-64 bg-earth rounded-full flex items-center justify-center cursor-pointer pulse-glow border-4 border-secondary">
                <i class="fa fa-heart text-warm text-4xl md:text-6xl"></i>
            </div>
            <p class="text-center text-warm mt-4 text-lg font-handwriting">
                è¿›å…¥æ ‘æ´
            </p>
        </div>
        
        <!-- æš—åŒ–é®ç½© -->
        <div id="darkenOverlay" class="darken-overlay"></div>
        
        <!-- æ ‡é¢˜ -->
        <div class="text-center z-10 mb-20">
            <h1 class="text-6xl md:text-8xl font-handwriting text-warm text-shadow mb-4 float-animation">
                å¿ƒçµæ ‘æ´
            </h1>
            <p class="text-xl md:text-2xl text-accent text-shadow">
                åœ¨è¿™é‡Œï¼Œä½ çš„å¿ƒå£°ä¼šè¢«æ¸©æŸ”è†å¬
            </p>
        </div>
        
        <!-- ç™»å½•æ³¨å†ŒæŒ‰é’® / ç”¨æˆ·ä¿¡æ¯ -->
        <div id="userArea" class="absolute top-4 right-4 flex flex-col md:flex-row gap-3">
            <button id="loginBtn" class="bg-primary hover:bg-earth text-warm px-4 py-2 rounded-lg transition-all duration-300">
                <i class="fa fa-sign-in mr-2"></i>ç™»å½•
            </button>
            <button id="registerBtn" class="bg-secondary hover:bg-primary text-earth px-4 py-2 rounded-lg transition-all duration-300">
                <i class="fa fa-user-plus mr-2"></i>æ³¨å†Œ
            </button>
            <button id="resetDataBtn" class="bg-error hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
                <i class="fa fa-bullseye mr-2"></i>é‡ç½®æ•°æ®
            </button>
        </div>
    </div>
    
    <!-- ç™»å½•æç¤ºæ¨¡æ€æ¡† -->
    <div id="loginRequiredModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 bg-primary rounded-full flex items-center justify-center">
                    <i class="fa fa-lock text-2xl text-warm"></i>
                </div>
                <h3 class="text-2xl font-handwriting text-primary mb-2">
                    éœ€è¦ç™»å½•
                </h3>
                <p class="text-earth">
                    è¯·å…ˆç™»å½•æˆ–æ³¨å†Œè´¦å·ï¼Œæ‰èƒ½ä½¿ç”¨æ ‘æ´åŠŸèƒ½
                </p>
            </div>
            
            <div class="flex justify-center gap-4">
                <button id="closeLoginRequiredModal" class="bg-earth hover:bg-primary text-warm px-6 py-2 rounded-lg transition-all duration-300">
                    å–æ¶ˆ
                </button>
                <button id="goToLoginBtn" class="bg-primary hover:bg-earth text-warm px-6 py-2 rounded-lg transition-all duration-300">
                    å»ç™»å½•
                </button>
            </div>
        </div>
    </div>
    
    <!-- é‡ç½®æ•°æ®ç¡®è®¤æ¨¡æ€æ¡† -->
    <div id="resetDataModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 bg-error rounded-full flex items-center justify-center">
                    <i class="fa fa-exclamation-triangle text-2xl text-white"></i>
                </div>
                <h3 class="text-2xl font-handwriting text-error mb-2">
                    é‡ç½®æ•°æ®
                </h3>
                <p class="text-earth">
                    æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®ã€ä¿¡ä»¶å’Œæ‹¥æŠ±è®°å½•ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚
                </p>
                <p class="text-error font-medium mt-2">
                    æ•°æ®å°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼
                </p>
            </div>
            
            <div class="flex justify-center gap-4">
                <button id="cancelResetBtn" class="bg-earth hover:bg-primary text-warm px-6 py-2 rounded-lg transition-all duration-300">
                    å–æ¶ˆ
                </button>
                <button id="confirmResetBtn" class="bg-error hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-all duration-300">
                    ç¡®è®¤é‡ç½®
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ“ä½œç»“æœæç¤ºæ¨¡æ€æ¡† -->
    <div id="resultModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <div id="resultIcon" class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center">
                    <!-- å›¾æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€è®¾ç½® -->
                </div>
                <h3 id="resultTitle" class="text-2xl font-handwriting mb-2">
                    <!-- æ ‡é¢˜å°†é€šè¿‡JavaScriptåŠ¨æ€è®¾ç½® -->
                </h3>
                <p id="resultMessage" class="text-earth">
                    <!-- æ¶ˆæ¯å°†é€šè¿‡JavaScriptåŠ¨æ€è®¾ç½® -->
                </p>
            </div>
            
            <div class="text-center">
                <button id="closeResultModal" class="bg-primary hover:bg-earth text-warm px-6 py-2 rounded-lg transition-all duration-300">
                    ç¡®å®š
                </button>
            </div>
        </div>
    </div>
    
    <!-- å€¾è¯‰åŠŸèƒ½é¡µé¢ -->
    <div id="å€¾è¯‰Page" class="hidden min-h-screen bg-gradient-to-b from-accent to-warm py-16">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16 fade-in">
                <h2 class="text-5xl font-handwriting text-primary mb-4">
                    é€‰æ‹©ä½ çš„æ–¹å¼
                </h2>
                <p class="text-lg text-earth">
                    åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å€¾è¯‰å¿ƒå£°ï¼Œä¹Ÿå¯ä»¥å€¾å¬ä»–äººçš„æ•…äº‹
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-12 max-w-4xl mx-auto">
                <!-- å†™ä¿¡é€‰é¡¹ -->
                <div class="bg-white rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 cursor-pointer letter-card slide-up" id="writeLetterBtn">
                    <div class="text-center">
                        <div class="w-24 h-24 mx-auto mb-6 bg-secondary rounded-full flex items-center justify-center">
                            <i class="fa fa-pencil text-3xl text-earth"></i>
                        </div>
                        <h3 class="text-2xl font-handwriting text-primary mb-4">
                            å†™ä¸‹å¿ƒå£°
                        </h3>
                        <p class="text-earth">
                            æŠŠä½ çš„çƒ¦æ¼ã€å¿«ä¹æˆ–ç§˜å¯†å†™ä¸‹æ¥ï¼ŒåŒ¿åæŠ•å…¥æ ‘æ´ä¸­
                        </p>
                    </div>
                </div>
                
                <!-- çª¥æ¢æ ‘æ´é€‰é¡¹ -->
                <div class="bg-white rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 cursor-pointer letter-card slide-up" id="exploreHoleBtn">
                    <div class="text-center">
                        <div class="w-24 h-24 mx-auto mb-6 bg-primary rounded-full flex items-center justify-center">
                            <i class="fa fa-eye text-3xl text-warm"></i>
                        </div>
                        <h3 class="text-2xl font-handwriting text-primary mb-4">
                            çª¥æ¢æ ‘æ´
                        </h3>
                        <p class="text-earth">
                            è¿›å…¥æ ‘æ´ï¼Œçœ‹çœ‹å…¶ä»–äººåˆ†äº«çš„æ•…äº‹å’Œå¿ƒå£°
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
            <div class="text-center mt-12 fade-in">
                <button id="backToHomeBtn" class="bg-earth hover:bg-primary text-warm px-6 py-3 rounded-lg transition-all duration-300">
                    <i class="fa fa-arrow-left mr-2"></i>è¿”å›æ ‘æ´
                </button>
            </div>
        </div>
    </div>
    
    <!-- å†™ä¿¡é¡µé¢ -->
    <div id="writeLetterPage" class="hidden min-h-screen bg-gradient-to-b from-accent to-warm py-16">
        <div class="container mx-auto px-4 max-w-3xl">
            <div class="bg-white rounded-2xl p-8 shadow-xl slide-up">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-handwriting text-primary mb-4">
                        å†™ä¸‹ä½ çš„å¿ƒå£°
                    </h2>
                    <p class="text-earth">
                        ä½ çš„ä¿¡ä»¶å°†ä»¥åŒ¿åå½¢å¼ä¿å­˜åœ¨æ ‘æ´ä¸­ï¼Œåªæœ‰ä½ èƒ½æ”¶åˆ°ä»–äººçš„æ‹¥æŠ±
                    </p>
                </div>
                
                <form id="letterForm" class="space-y-6">
                    <div>
                        <label for="letterTitle" class="block text-earth text-sm font-medium mb-2">
                            ä¿¡ä»¶æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰
                        </label>
                        <input type="text" id="letterTitle" placeholder="ç»™ä½ çš„ä¿¡ä»¶èµ·ä¸ªæ ‡é¢˜..." class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    
                    <div>
                        <label for="letterContent" class="block text-earth text-sm font-medium mb-2">
                            ä¿¡ä»¶å†…å®¹
                        </label>
                        <textarea id="letterContent" rows="10" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å¿ƒå£°..." class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none" required=""></textarea>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <button type="button" id="backToå€¾è¯‰Btn" class="bg-earth hover:bg-primary text-warm px-6 py-3 rounded-lg transition-all duration-300">
                            <i class="fa fa-arrow-left mr-2"></i>è¿”å›
                        </button>
                        <button type="submit" id="submitLetterBtn" class="bg-primary hover:bg-earth text-warm px-8 py-3 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-paper-plane mr-2"></i>æŠ•å…¥æ ‘æ´
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- æ ‘æ´å†…éƒ¨é¡µé¢ -->
    <div id="treeholeInsidePage" class="hidden min-h-screen bg-gradient-to-b from-earth to-primary py-16 relative overflow-hidden">
        <!-- èƒŒæ™¯ä¿¡ä»¶é£˜è½æ•ˆæœ -->
        <div id="floatingLetters" class="absolute inset-0 pointer-events-none"></div>
        
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-12 fade-in">
                <h2 class="text-5xl font-handwriting text-warm text-shadow mb-4">
                    æ ‘æ´æ·±å¤„
                </h2>
                <p class="text-xl text-accent text-shadow">
                    åœ¨è¿™é‡Œï¼Œæ¯ä¸€å°ä¿¡éƒ½æ‰¿è½½ç€ä¸€ä¸ªæ•…äº‹
                </p>
            </div>
            
            <!-- ä¿¡ä»¶ç½‘æ ¼ -->
            <div id="lettersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                <!-- ä¿¡ä»¶å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="text-center mt-12 flex justify-center gap-6 fade-in">
                <button id="refreshLettersBtn" class="bg-secondary hover:bg-accent text-earth px-6 py-3 rounded-lg transition-all duration-300">
                    <i class="fa fa-bullseye mr-2"></i>åˆ·æ–°ä¿¡ä»¶
                </button>
                <button id="leaveTreeholeBtn" class="bg-accent hover:bg-secondary text-earth px-6 py-3 rounded-lg transition-all duration-300">
                    <i class="fa fa-arrow-left mr-2"></i>ç¦»å¼€æ ‘æ´
                </button>
            </div>
        </div>
    </div>
    
    <!-- ä¿¡ä»¶è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="letterModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <h3 id="modalLetterTitle" class="text-3xl font-handwriting text-primary mb-2"></h3>
                <p id="modalLetterDate" class="text-earth text-sm"></p>
            </div>
            
            <div id="modalLetterContent" class="text-earth text-lg leading-relaxed mb-8 p-6 bg-accent rounded-lg">
                <!-- ä¿¡ä»¶å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="flex justify-between items-center">
                <button id="sendHugBtn" class="bg-primary hover:bg-earth text-warm px-6 py-3 rounded-lg transition-all duration-300">
                    <i class="fa fa-heart mr-2"></i>å‘é€æ‹¥æŠ±
                </button>
                <button id="closeModalBtn" class="bg-earth hover:bg-primary text-warm px-6 py-3 rounded-lg transition-all duration-300">
                    <i class="fa fa-times mr-2"></i>å…³é—­
                </button>
            </div>
        </div>
    </div>
    
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <h3 class="text-3xl font-handwriting text-primary mb-2">
                    ç™»å½•
                </h3>
                <p class="text-earth">
                    ç™»å½•ä½ çš„è´¦å·ï¼Œç®¡ç†ä½ çš„ä¿¡ä»¶å’Œæ‹¥æŠ±
                </p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginUsername" class="block text-earth text-sm font-medium mb-2">
                        ç”¨æˆ·å
                    </label>
                    <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div>
                    <label for="loginPassword" class="block text-earth text-sm font-medium mb-2">
                        å¯†ç 
                    </label>
                    <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div class="flex justify-between items-center">
                    <button type="button" id="closeLoginModal" class="bg-earth hover:bg-primary text-warm px-4 py-2 rounded-lg transition-all duration-300">
                        å…³é—­
                    </button>
                    <button type="submit" class="bg-primary hover:bg-earth text-warm px-6 py-2 rounded-lg transition-all duration-300">
                        ç™»å½•
                    </button>
                </div>
            </form>
            
            <div class="text-center mt-4">
                <p class="text-earth text-sm">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<button id="switchToRegister" class="text-primary hover:underline">ç«‹å³æ³¨å†Œ</button>
                </p>
            </div>
        </div>
    </div>
    
    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="registerModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 relative z-10 shadow-2xl slide-up">
            <div class="text-center mb-6">
                <h3 class="text-3xl font-handwriting text-primary mb-2">
                    æ³¨å†Œ
                </h3>
                <p class="text-earth">
                    åˆ›å»ºä½ çš„è´¦å·ï¼Œå¼€å§‹ä½¿ç”¨æ ‘æ´æœåŠ¡
                </p>
            </div>
            
            <form id="registerForm" class="space-y-4">
                <div>
                    <label for="registerUsername" class="block text-earth text-sm font-medium mb-2">
                        ç”¨æˆ·å
                    </label>
                    <input type="text" id="registerUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div>
                    <label for="registerEmail" class="block text-earth text-sm font-medium mb-2">
                        é‚®ç®±
                    </label>
                    <input type="email" id="registerEmail" placeholder="è¯·è¾“å…¥é‚®ç®±" class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div>
                    <label for="registerPassword" class="block text-earth text-sm font-medium mb-2">
                        å¯†ç 
                    </label>
                    <input type="password" id="registerPassword" placeholder="è¯·è¾“å…¥å¯†ç " class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div>
                    <label for="confirmPassword" class="block text-earth text-sm font-medium mb-2">
                        ç¡®è®¤å¯†ç 
                    </label>
                    <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " class="w-full px-4 py-3 border border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required="">
                </div>
                
                <div class="flex justify-between items-center">
                    <button type="button" id="closeRegisterModal" class="bg-earth hover:bg-primary text-warm px-4 py-2 rounded-lg transition-all duration-300">
                        å…³é—­
                    </button>
                    <button type="submit" class="bg-primary hover:bg-earth text-warm px-6 py-2 rounded-lg transition-all duration-300">
                        æ³¨å†Œ
                    </button>
                </div>
            </form>
            
            <div class="text-center mt-4">
                <p class="text-earth text-sm">
                    å·²æœ‰è´¦å·ï¼Ÿ<button id="switchToLogin" class="text-primary hover:underline">ç«‹å³ç™»å½•</button>
                </p>
            </div>
        </div>
    </div>
    
    <!-- æ‹¥æŠ±é€šçŸ¥ -->
    <div id="hugNotification" class="hidden fixed top-4 right-4 bg-primary text-warm px-6 py-3 rounded-lg shadow-lg z-50 slide-up cursor-pointer notification">
        <div class="flex items-center">
            <i class="fa fa-heart mr-2"></i>
            <span>æœ‰äººç»™ä½ çš„ä¿¡ä»¶å‘é€äº†ä¸€ä¸ªæ‹¥æŠ±ï¼</span>
        </div>
    </div>
    
    <!-- å®æ—¶æ‹¥æŠ±é€šçŸ¥ -->
    <div id="realTimeHugNotification" class="hidden fixed bottom-4 left-4 bg-rose-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 hug-notification cursor-pointer notification">
        <div class="flex items-center">
            <i class="fa fa-heart mr-2"></i>
            <span>ğŸ’– æœ‰äººåˆšåˆšç»™ä½ çš„ä¿¡ä»¶å‘é€äº†ä¸€ä¸ªæ¸©æš–çš„æ‹¥æŠ±ï¼</span>
        </div>
    </div>
    
    <!-- æ‹¥æŠ±ç»Ÿè®¡é€šçŸ¥ -->
    <div id="hugCountNotification" class="hidden fixed top-12 left-4 bg-hugCount text-white px-6 py-3 rounded-lg shadow-lg z-50 stat-notification cursor-pointer notification">
        <div class="flex items-center">
            <i class="fa fa-heart mr-2"></i>
            <span id="hugCountText">ä½ ä»æ³¨å†Œä»¥æ¥ä¸€å…±æ”¶åˆ°äº† X ä¸ªæ‹¥æŠ±ï¼</span>
        </div>
    </div>
    
    <!-- é²œèŠ±ç»Ÿè®¡é€šçŸ¥ -->
    <div id="flowerCountNotification" class="hidden fixed top-24 left-4 bg-flower text-white px-6 py-3 rounded-lg shadow-lg z-50 stat-notification cursor-pointer notification">
        <div class="flex items-center">
            <i class="fa fa-bullseye mr-2"></i>
            <span id="flowerCountText">ä½ ä¸€å…±è·å¾—äº† X æœµé²œèŠ±ï¼</span>
        </div>
    </div>
    
    <!-- æ–°æ‹¥æŠ±æé†’é€šçŸ¥ -->
    <div id="newHugReminder" class="hidden fixed top-36 left-4 bg-rose-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 stat-notification cursor-pointer notification">
        <div class="flex items-center">
            <i class="fa fa-heart mr-2"></i>
            <span id="newHugReminderText">ä½ æœ‰ X ä¸ªæ–°çš„æ‹¥æŠ±ï¼</span>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = null;
        let letters = [];
        let users = [];
        
        // é¡µé¢å…ƒç´ 
        const homePage = document.getElementById('homePage');
        const å€¾è¯‰Page = document.getElementById('å€¾è¯‰Page');
        const writeLetterPage = document.getElementById('writeLetterPage');
        const treeholeInsidePage = document.getElementById('treeholeInsidePage');
        const letterModal = document.getElementById('letterModal');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const loginRequiredModal = document.getElementById('loginRequiredModal');
        const resetDataModal = document.getElementById('resetDataModal');
        const resultModal = document.getElementById('resultModal');
        
        // åˆå§‹åŒ–æ•°æ®
        function initData() {
            try {
                // ä»localStorageåŠ è½½æ•°æ®
                if (localStorage.getItem('users')) {
                    users = JSON.parse(localStorage.getItem('users'));
                    
                    // æ•°æ®éªŒè¯ï¼šç¡®ä¿ç”¨æˆ·æ•°æ®æ ¼å¼æ­£ç¡®
                    if (!Array.isArray(users)) {
                        throw new Error('ç”¨æˆ·æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„ç”¨æˆ·å
                    const usernames = new Set();
                    const uniqueUsers = [];
                    
                    users.forEach(user => {
                        // éªŒè¯ç”¨æˆ·æ•°æ®ç»“æ„
                        if (user && user.id && user.username && user.password && user.email) {
                            if (!usernames.has(user.username)) {
                                usernames.add(user.username);
                                uniqueUsers.push(user);
                            } else {
                                console.warn(`å‘ç°é‡å¤ç”¨æˆ·å: ${user.username}ï¼Œå·²è‡ªåŠ¨å»é‡`);
                            }
                        }
                    });
                    
                    users = uniqueUsers;
                    localStorage.setItem('users', JSON.stringify(users));
                } else {
                    // åˆ›å»ºé»˜è®¤æµ‹è¯•ç”¨æˆ·
                    users = [
                        {
                            id: 1,
                            username: 'testuser1',
                            password: '123456',
                            email: 'test1@example.com',
                            letters: [],
                            hugsReceived: [],
                            flowers: 0,
                            lastLoginDate: null
                        },
                        {
                            id: 2,
                            username: 'testuser2',
                            password: '123456',
                            email: 'test2@example.com',
                            letters: [],
                            hugsReceived: [],
                            flowers: 0,
                            lastLoginDate: null
                        }
                    ];
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                if (localStorage.getItem('letters')) {
                    letters = JSON.parse(localStorage.getItem('letters'));
                    
                    // æ•°æ®éªŒè¯ï¼šç¡®ä¿ä¿¡ä»¶æ•°æ®æ ¼å¼æ­£ç¡®
                    if (!Array.isArray(letters)) {
                        throw new Error('ä¿¡ä»¶æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                    
                    // è¿‡æ»¤æ‰æ— æ•ˆçš„ä¿¡ä»¶
                    const validLetters = letters.filter(letter => 
                        letter && letter.id && letter.title && letter.content && letter.authorId && letter.date
                    );
                    
                    letters = validLetters;
                    localStorage.setItem('letters', JSON.stringify(letters));
                } else {
                    // åˆ›å»ºé»˜è®¤æµ‹è¯•ä¿¡ä»¶
                    letters = [
                        {
                            id: 1,
                            title: 'æˆ‘çš„å°ç§˜å¯†',
                            content: 'ä»Šå¤©æˆ‘å·å·ä¹°äº†ä¸€å—è›‹ç³•ï¼Œæ²¡æœ‰å’Œå®¶äººåˆ†äº«ï¼Œæ„Ÿè§‰æœ‰ç‚¹å†…ç–šï¼Œä½†çœŸçš„å¾ˆå¥½åƒã€‚',
                            authorId: 1,
                            date: '2026-02-01',
                            hugs: 5
                        },
                        {
                            id: 2,
                            title: 'å·¥ä½œçš„çƒ¦æ¼',
                            content: 'æœ€è¿‘å·¥ä½œå‹åŠ›å¥½å¤§ï¼Œæ„Ÿè§‰è‡ªå·±å¿«è¦æ’‘ä¸ä¸‹å»äº†ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆåŠã€‚',
                            authorId: 2,
                            date: '2026-02-02',
                            hugs: 12
                        },
                        {
                            id: 3,
                            title: 'æš—æ‹çš„å¿ƒæƒ…',
                            content: 'æˆ‘å–œæ¬¢ä¸Šäº†å…¬å¸çš„åŒäº‹ï¼Œä½†ä¸æ•¢å‘Šè¯‰ä»–ï¼Œæ¯å¤©èƒ½çœ‹åˆ°ä»–å°±å¾ˆå¼€å¿ƒäº†ã€‚',
                            authorId: 1,
                            date: '2026-02-03',
                            hugs: 8
                        }
                    ];
                    localStorage.setItem('letters', JSON.stringify(letters));
                }
                
                // æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€
                if (localStorage.getItem('currentUser')) {
                    try {
                        currentUser = JSON.parse(localStorage.getItem('currentUser'));
                        
                        // éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å­˜åœ¨äºç”¨æˆ·åˆ—è¡¨ä¸­
                        const userExists = users.some(user => user.id === currentUser.id);
                        if (!userExists) {
                            throw new Error('å½“å‰ç™»å½•ç”¨æˆ·ä¸å­˜åœ¨äºç”¨æˆ·åˆ—è¡¨ä¸­');
                        }
                        
                        updateUserArea();
                        checkForNewHugs();
                        showDailyStats();
                    } catch (error) {
                        console.error('å½“å‰ç”¨æˆ·æ•°æ®æ— æ•ˆ:', error);
                        localStorage.removeItem('currentUser');
                        currentUser = null;
                        updateUserArea();
                    }
                }
            } catch (error) {
                console.error('æ•°æ®åˆå§‹åŒ–å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'æ•°æ®åŠ è½½å¤±è´¥ï¼Œå»ºè®®é‡ç½®æ•°æ®', 'error');
            }
        }
        
        // æ›´æ–°ç”¨æˆ·åŒºåŸŸæ˜¾ç¤º
        function updateUserArea() {
            const userArea = document.getElementById('userArea');
            
            if (currentUser) {
                // æ£€æŸ¥æ˜¯å¦æœ‰æœªè¯»æ‹¥æŠ±
                const userIndex = users.findIndex(user => user.id === currentUser.id);
                const unreadHugs = userIndex !== -1 ? users[userIndex].hugsReceived.filter(hug => !hug.isRead).length : 0;
                
                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œé€€å‡ºæŒ‰é’®
                if (unreadHugs > 0) {
                    userArea.innerHTML = `
                        <div class="user-info text-warm px-4 py-2 rounded-lg flex items-center gap-3">
                            <i class="fa fa-user"></i>
                            <span>${currentUser.username}</span>
                            <span id="hugBadge" class="bg-rose-600 text-white text-xs px-2 py-1 rounded-full hug-badge">${unreadHugs}ä¸ªæ–°æ‹¥æŠ±</span>
                        </div>
                        <button id="logoutBtn" class="bg-earth hover:bg-primary text-warm px-4 py-2 rounded-lg transition-all duration-300">
                            <i class="fa fa-sign-out mr-2"></i>é€€å‡º
                        </button>
                        <button id="resetDataBtn" class="bg-error hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            <i class="fa fa-bullseye mr-2"></i>é‡ç½®æ•°æ®
                        </button>
                    `;
                    
                    // ç»‘å®šæ‹¥æŠ±å¾½ç« ç‚¹å‡»äº‹ä»¶
                    document.getElementById('hugBadge').addEventListener('click', function() {
                        // ç‚¹å‡»åæ›´æ–°ä¸ºæ­£å¸¸ç”¨æˆ·ä¿¡æ¯
                        updateUserArea();
                        
                        // æ˜¾ç¤ºæ‹¥æŠ±ç»Ÿè®¡è¯¦æƒ…
                        const totalHugs = users.find(user => user.id === currentUser.id).hugsReceived.length;
                        const hugCountText = document.getElementById('hugCountText');
                        hugCountText.textContent = `ä½ ä»æ³¨å†Œä»¥æ¥ä¸€å…±æ”¶åˆ°äº† ${totalHugs} ä¸ªæ‹¥æŠ±ï¼`;
                        
                        const hugCountNotification = document.getElementById('hugCountNotification');
                        hugCountNotification.classList.remove('hidden');
                    });
                } else {
                    userArea.innerHTML = `
                        <div class="user-info text-warm px-4 py-2 rounded-lg flex items-center gap-3">
                            <i class="fa fa-user"></i>
                            <span>${currentUser.username}</span>
                        </div>
                        <button id="logoutBtn" class="bg-earth hover:bg-primary text-warm px-4 py-2 rounded-lg transition-all duration-300">
                            <i class="fa fa-sign-out mr-2"></i>é€€å‡º
                        </button>
                        <button id="resetDataBtn" class="bg-error hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            <i class="fa fa-bullseye mr-2"></i>é‡ç½®æ•°æ®
                        </button>
                    `;
                }
                
                // ç»‘å®šé€€å‡ºç™»å½•äº‹ä»¶
                document.getElementById('logoutBtn').addEventListener('click', logout);
            } else {
                // æ˜¾ç¤ºç™»å½•æ³¨å†ŒæŒ‰é’®
                userArea.innerHTML = `
                    <button id="loginBtn" class="bg-primary hover:bg-earth text-warm px-4 py-2 rounded-lg transition-all duration-300">
                        <i class="fa fa-sign-in mr-2"></i>ç™»å½•
                    </button>
                    <button id="registerBtn" class="bg-secondary hover:bg-primary text-earth px-4 py-2 rounded-lg transition-all duration-300">
                        <i class="fa fa-user-plus mr-2"></i>æ³¨å†Œ
                    </button>
                    <button id="resetDataBtn" class="bg-error hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
                        <i class="fa fa-bullseye mr-2"></i>é‡ç½®æ•°æ®
                    </button>
                `;
                
                // ç»‘å®šç™»å½•æ³¨å†Œäº‹ä»¶
                document.getElementById('loginBtn').addEventListener('click', () => showModal('loginModal'));
                document.getElementById('registerBtn').addEventListener('click', () => showModal('registerModal'));
            }
            
            // ç»‘å®šé‡ç½®æ•°æ®äº‹ä»¶
            document.getElementById('resetDataBtn').addEventListener('click', () => showModal('resetDataModal'));
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            if (!currentUser) {
                showModal('loginRequiredModal');
                return false;
            }
            return true;
        }
        
        // é¡µé¢åˆ‡æ¢å‡½æ•°
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            const pages = [homePage, å€¾è¯‰Page, writeLetterPage, treeholeInsidePage];
            pages.forEach(page => page.classList.add('hidden'));
            
            // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
            document.getElementById(pageId).classList.remove('hidden');
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        
        // éšè—æ¨¡æ€æ¡†
        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        // æ˜¾ç¤ºç»“æœæ¨¡æ€æ¡†
        function showResultModal(title, message, type = 'info') {
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            const resultIcon = document.getElementById('resultIcon');
            
            resultTitle.textContent = title;
            resultMessage.textContent = message;
            
            // è®¾ç½®å›¾æ ‡
            if (type === 'success') {
                resultIcon.className = 'w-16 h-16 mx-auto mb-4 bg-success rounded-full flex items-center justify-center';
                resultIcon.innerHTML = '<i class="fa fa-check text-2xl text-white"></i>';
                resultTitle.className = 'text-2xl font-handwriting text-success mb-2';
            } else if (type === 'error') {
                resultIcon.className = 'w-16 h-16 mx-auto mb-4 bg-error rounded-full flex items-center justify-center';
                resultIcon.innerHTML = '<i class="fa fa-times text-2xl text-white"></i>';
                resultTitle.className = 'text-2xl font-handwriting text-error mb-2';
            } else {
                resultIcon.className = 'w-16 h-16 mx-auto mb-4 bg-primary rounded-full flex items-center justify-center';
                resultIcon.innerHTML = '<i class="fa fa-info text-2xl text-warm"></i>';
                resultTitle.className = 'text-2xl font-handwriting text-primary mb-2';
            }
            
            showModal('resultModal');
        }
        
        // ç”Ÿæˆéšæœºä¿¡ä»¶ï¼ˆæ’é™¤å½“å‰ç”¨æˆ·çš„ä¿¡ä»¶ï¼Œç¡®ä¿ä¸é‡å¤ï¼‰
        function generateRandomLetters(count) {
            try {
                // è¿‡æ»¤æ‰å½“å‰ç”¨æˆ·çš„ä¿¡ä»¶
                const otherLetters = letters.filter(letter => letter.authorId !== currentUser.id);
                
                // å¦‚æœæ²¡æœ‰å…¶ä»–ç”¨æˆ·çš„ä¿¡ä»¶ï¼Œåˆ›å»ºä¸€äº›ç¤ºä¾‹ä¿¡ä»¶
                if (otherLetters.length === 0) {
                    const sampleLetters = [
                        {
                            title: 'æˆ‘çš„æ¢¦æƒ³',
                            content: 'æˆ‘ä¸€ç›´æƒ³æˆä¸ºä¸€åç”»å®¶ï¼Œä½†å®¶äººå¸Œæœ›æˆ‘æ‰¾ä¸€ä»½ç¨³å®šçš„å·¥ä½œã€‚æˆ‘ä¸çŸ¥é“è¯¥å¦‚ä½•é€‰æ‹©ã€‚',
                            authorId: 999, // ä½¿ç”¨ä¸å­˜åœ¨çš„ç”¨æˆ·ID
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            hugs: Math.floor(Math.random() * 20)
                        },
                        {
                            title: 'å‹è°Šçš„å›°æƒ‘',
                            content: 'æœ€è¿‘å’Œæœ€å¥½çš„æœ‹å‹åµæ¶äº†ï¼Œæˆ‘ä»¬å·²ç»ä¸€ä¸ªæ˜ŸæœŸæ²¡æœ‰è¯´è¯äº†ï¼Œæˆ‘å¾ˆæƒ³å¿µå¥¹ã€‚',
                            authorId: 998, // ä½¿ç”¨ä¸å­˜åœ¨çš„ç”¨æˆ·ID
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            hugs: Math.floor(Math.random() * 15)
                        },
                        {
                            title: 'å¯¹æœªæ¥çš„è¿·èŒ«',
                            content: 'å¤§å­¦æ¯•ä¸šäº†ï¼Œæˆ‘ä¸çŸ¥é“è‡ªå·±æƒ³åšä»€ä¹ˆï¼Œæ„Ÿè§‰å¾ˆè¿·èŒ«ï¼Œæ¯å¤©éƒ½åœ¨ç„¦è™‘ä¸­åº¦è¿‡ã€‚',
                            authorId: 997,
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            hugs: Math.floor(Math.random() * 18)
                        },
                        {
                            title: 'å®¶åº­çš„æ¸©æš–',
                            content: 'ä»Šå¤©å¦ˆå¦ˆåšäº†æˆ‘æœ€çˆ±åƒçš„èœï¼Œè™½ç„¶åªæ˜¯ç®€å•çš„å®¶å¸¸èœï¼Œä½†æˆ‘æ„Ÿå—åˆ°äº†æ»¡æ»¡çš„çˆ±ã€‚',
                            authorId: 996,
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            hugs: Math.floor(Math.random() * 25)
                        }
                    ];
                    
                    // éšæœºé€‰æ‹©ä¿¡ä»¶ï¼Œç¡®ä¿ä¸é‡å¤
                    const randomLetters = [];
                    const selectedIds = new Set();
                    for (let i = 0; i < count && selectedIds.size < sampleLetters.length; i++) {
                        const randomIndex = Math.floor(Math.random() * sampleLetters.length);
                        const letter = sampleLetters[randomIndex];
                        if (!selectedIds.has(letter.title)) {
                            selectedIds.add(letter.title);
                            randomLetters.push({
                                ...letter,
                                id: Date.now() + i
                            });
                        }
                    }
                    
                    return randomLetters;
                }
                
                // éšæœºé€‰æ‹©ä¸é‡å¤çš„ä¿¡ä»¶
                const randomLetters = [];
                const selectedIds = new Set();
                
                while (randomLetters.length < count && selectedIds.size < otherLetters.length) {
                    const randomIndex = Math.floor(Math.random() * otherLetters.length);
                    const letter = otherLetters[randomIndex];
                    if (!selectedIds.has(letter.id)) {
                        selectedIds.add(letter.id);
                        randomLetters.push(letter);
                    }
                }
                
                return randomLetters;
            } catch (error) {
                console.error('ç”Ÿæˆéšæœºä¿¡ä»¶å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'åŠ è½½ä¿¡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                return [];
            }
        }
        
        // æ¸²æŸ“ä¿¡ä»¶ç½‘æ ¼
        function renderLettersGrid() {
            try {
                const lettersGrid = document.getElementById('lettersGrid');
                lettersGrid.innerHTML = '';
                
                // éšæœºé€‰æ‹©6-9å°ä¸é‡å¤çš„ä¿¡ä»¶
                const randomLetters = generateRandomLetters(Math.floor(Math.random() * 4) + 6);
                
                randomLetters.forEach(letter => {
                    const letterCard = document.createElement('div');
                    letterCard.className = 'bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer letter-card';
                    letterCard.innerHTML = `
                        <div class="text-center">
                            <div class="w-16 h-16 mx-auto mb-4 bg-secondary rounded-full flex items-center justify-center">
                                <img src="https://aka.doubaocdn.com/s/y4NV1w0ZA3" alt="ä¿¡ä»¶" class="w-8 h-8">
                            </div>
                            <h4 class="text-lg font-handwriting text-primary mb-2">${letter.title}</h4>
                            <p class="text-earth text-sm mb-3">${letter.content.substring(0, 50)}...</p>
                            <div class="flex items-center justify-center text-primary">
                                <i class="fa fa-heart mr-1"></i>
                                <span>${letter.hugs}</span>
                            </div>
                        </div>
                    `;
                    
                    letterCard.addEventListener('click', () => {
                        showLetterModal(letter);
                    });
                    
                    lettersGrid.appendChild(letterCard);
                });
            } catch (error) {
                console.error('æ¸²æŸ“ä¿¡ä»¶ç½‘æ ¼å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'åŠ è½½ä¿¡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // æ˜¾ç¤ºä¿¡ä»¶è¯¦æƒ…æ¨¡æ€æ¡†
        function showLetterModal(letter) {
            try {
                document.getElementById('modalLetterTitle').textContent = letter.title;
                document.getElementById('modalLetterDate').textContent = `å†™äº ${letter.date}`;
                document.getElementById('modalLetterContent').textContent = letter.content;
                
                // ä¿å­˜å½“å‰ä¿¡ä»¶IDï¼Œç”¨äºå‘é€æ‹¥æŠ±
                document.getElementById('sendHugBtn').dataset.letterId = letter.id;
                document.getElementById('sendHugBtn').dataset.authorId = letter.authorId;
                
                showModal('letterModal');
            } catch (error) {
                console.error('æ˜¾ç¤ºä¿¡ä»¶è¯¦æƒ…å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'åŠ è½½ä¿¡ä»¶è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // å‘é€æ‹¥æŠ±
        function sendHug(letterId, authorId) {
            try {
                if (!currentUser) {
                    alert('è¯·å…ˆç™»å½•æ‰èƒ½å‘é€æ‹¥æŠ±');
                    showModal('loginModal');
                    return;
                }
                
                // æ‰¾åˆ°å¯¹åº”çš„ä¿¡ä»¶å¹¶å¢åŠ æ‹¥æŠ±æ•°
                const letterIndex = letters.findIndex(letter => letter.id == letterId);
                if (letterIndex !== -1) {
                    letters[letterIndex].hugs++;
                    localStorage.setItem('letters', JSON.stringify(letters));
                }
                
                // æ£€æŸ¥ä½œè€…æ˜¯å¦å½“å‰åœ¨çº¿ï¼ˆåœ¨å½“å‰æ ‡ç­¾é¡µï¼‰
                const isAuthorOnline = localStorage.getItem('currentUser') && 
                    JSON.parse(localStorage.getItem('currentUser')).id == authorId;
                
                // åˆ›å»ºæ‹¥æŠ±è®°å½•
                const hugRecord = {
                    letterId: letterId,
                    fromUser: currentUser.username,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString(),
                    isRead: false
                };
                
                // å¦‚æœä½œè€…å½“å‰åœ¨çº¿ï¼Œç›´æ¥æ·»åŠ æ‹¥æŠ±è®°å½•å¹¶æ˜¾ç¤ºå®æ—¶é€šçŸ¥
                if (isAuthorOnline) {
                    const authorIndex = users.findIndex(user => user.id == authorId);
                    if (authorIndex !== -1) {
                        users[authorIndex].hugsReceived.push(hugRecord);
                        localStorage.setItem('users', JSON.stringify(users));
                        
                        // æ˜¾ç¤ºå®æ—¶æ‹¥æŠ±é€šçŸ¥
                        showRealTimeHugNotification();
                        
                        // æ›´æ–°ç”¨æˆ·åŒºåŸŸæ˜¾ç¤º
                        updateUserArea();
                    }
                } else {
                    // å¦‚æœä½œè€…ä¸åœ¨çº¿ï¼Œå°†æ‹¥æŠ±è®°å½•å­˜å‚¨åˆ°localStorage
                    localStorage.setItem('hugNotification_' + authorId, JSON.stringify(hugRecord));
                    
                    // å‘é€æµè§ˆå™¨é€šçŸ¥
                    if (Notification.permission === 'granted') {
                        new Notification('æ”¶åˆ°æ–°æ‹¥æŠ±ï¼', {
                            body: `${currentUser.username}ç»™ä½ çš„ä¿¡ä»¶å‘é€äº†ä¸€ä¸ªæ¸©æš–çš„æ‹¥æŠ±ï¼`,
                            icon: 'https://aka.doubaocdn.com/s/hDii1w0ZA2'
                        });
                    }
                }
                
                // ç»™å‘é€æ‹¥æŠ±çš„ç”¨æˆ·å¢åŠ é²œèŠ±
                const senderIndex = users.findIndex(user => user.id == currentUser.id);
                if (senderIndex !== -1) {
                    users[senderIndex].flowers = (users[senderIndex].flowers || 0) + 1;
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // æ›´æ–°å½“å‰ç”¨æˆ·å¯¹è±¡
                    currentUser.flowers = users[senderIndex].flowers;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // æ˜¾ç¤ºè·å¾—é²œèŠ±çš„æç¤º
                    showFlowerNotification();
                }
                
                // æ˜¾ç¤ºæ‹¥æŠ±æˆåŠŸæç¤º
                showResultModal('æˆåŠŸ', 'æ‹¥æŠ±å·²å‘é€ï¼ä½ è·å¾—äº†1æœµé²œèŠ±ï¼', 'success');
                hideModal('letterModal');
                renderLettersGrid();
            } catch (error) {
                console.error('å‘é€æ‹¥æŠ±å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'å‘é€æ‹¥æŠ±å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // æ˜¾ç¤ºå®æ—¶æ‹¥æŠ±é€šçŸ¥
        function showRealTimeHugNotification() {
            const realTimeHugNotification = document.getElementById('realTimeHugNotification');
            realTimeHugNotification.classList.remove('hidden');
            
            setTimeout(() => {
                realTimeHugNotification.classList.add('hidden');
            }, 4000);
        }
        
        // æ˜¾ç¤ºé²œèŠ±é€šçŸ¥
        function showFlowerNotification() {
            const flowerNotification = document.getElementById('flowerCountNotification');
            const flowerCountText = document.getElementById('flowerCountText');
            flowerCountText.textContent = `ä½ è·å¾—äº†1æœµé²œèŠ±ï¼æ€»å…±æ‹¥æœ‰ ${currentUser.flowers} æœµé²œèŠ±ï¼`;
            
            flowerNotification.classList.remove('hidden');
            
            setTimeout(() => {
                flowerNotification.classList.add('hidden');
            }, 5000);
        }
        
        // æ£€æŸ¥æ–°çš„æ‹¥æŠ±é€šçŸ¥
        function checkForNewHugs() {
            try {
                if (!currentUser) return 0;
                
                let newHugCount = 0;
                
                // æ£€æŸ¥localStorageä¸­çš„æ–°æ‹¥æŠ±é€šçŸ¥
                const hugNotification = localStorage.getItem('hugNotification_' + currentUser.id);
                if (hugNotification) {
                    const hugRecord = JSON.parse(hugNotification);
                    
                    // å°†æ‹¥æŠ±è®°å½•æ·»åŠ åˆ°ç”¨æˆ·çš„hugsReceivedåˆ—è¡¨
                    const userIndex = users.findIndex(user => user.id == currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex].hugsReceived.push(hugRecord);
                        localStorage.setItem('users', JSON.stringify(users));
                        localStorage.removeItem('hugNotification_' + currentUser.id);
                        
                        // æ˜¾ç¤ºå®æ—¶æ‹¥æŠ±é€šçŸ¥
                        showRealTimeHugNotification();
                        
                        newHugCount++;
                    }
                }
                
                // æ£€æŸ¥æœªè¯»æ‹¥æŠ±
                const userIndex = users.findIndex(user => user.id == currentUser.id);
                if (userIndex !== -1) {
                    const unreadHugs = users[userIndex].hugsReceived.filter(hug => !hug.isRead);
                    newHugCount = unreadHugs.length;
                    
                    if (newHugCount > 0) {
                        // æ˜¾ç¤ºæ–°æ‹¥æŠ±æé†’
                        const newHugReminder = document.getElementById('newHugReminder');
                        const newHugReminderText = document.getElementById('newHugReminderText');
                        newHugReminderText.textContent = `ä½ æœ‰ ${newHugCount} ä¸ªæ–°çš„æ‹¥æŠ±ï¼`;
                        newHugReminder.classList.remove('hidden');
                        
                        // æ ‡è®°ä¸ºå·²è¯»
                        unreadHugs.forEach(hug => {
                            hug.isRead = true;
                        });
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                }
                
                // æ›´æ–°ç”¨æˆ·åŒºåŸŸæ˜¾ç¤º
                updateUserArea();
                
                return newHugCount;
            } catch (error) {
                console.error('æ£€æŸ¥æ–°æ‹¥æŠ±å¤±è´¥:', error);
                return 0;
            }
        }
        
        // æ˜¾ç¤ºæ¯æ—¥ç»Ÿè®¡ä¿¡æ¯
        function showDailyStats() {
            try {
                if (!currentUser) return;
                
                const today = new Date().toISOString().split('T')[0];
                const userIndex = users.findIndex(user => user.id == currentUser.id);
                
                if (userIndex !== -1) {
                    const user = users[userIndex];
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å¤©é¦–æ¬¡ç™»å½•
                    if (!user.lastLoginDate || user.lastLoginDate !== today) {
                        // æ›´æ–°æœ€åç™»å½•æ—¥æœŸ
                        user.lastLoginDate = today;
                        localStorage.setItem('users', JSON.stringify(users));
                        
                        // æ›´æ–°å½“å‰ç”¨æˆ·å¯¹è±¡
                        currentUser.lastLoginDate = today;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // æ˜¾ç¤ºæ‹¥æŠ±ç»Ÿè®¡
                        const totalHugs = user.hugsReceived.length;
                        if (totalHugs > 0) {
                            const hugCountText = document.getElementById('hugCountText');
                            hugCountText.textContent = `ä½ ä»æ³¨å†Œä»¥æ¥ä¸€å…±æ”¶åˆ°äº† ${totalHugs} ä¸ªæ‹¥æŠ±ï¼`;
                            
                            const hugCountNotification = document.getElementById('hugCountNotification');
                            hugCountNotification.classList.remove('hidden');
                        }
                    }
                    
                    // æ˜¾ç¤ºé²œèŠ±ç»Ÿè®¡
                    const totalFlowers = user.flowers || 0;
                    if (totalFlowers > 0) {
                        const flowerCountText = document.getElementById('flowerCountText');
                        flowerCountText.textContent = `ä½ ä¸€å…±è·å¾—äº† ${totalFlowers} æœµé²œèŠ±ï¼`;
                        
                        const flowerCountNotification = document.getElementById('flowerCountNotification');
                        flowerCountNotification.classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error('æ˜¾ç¤ºæ¯æ—¥ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // æ³¨å†Œç”¨æˆ·
        function registerUser(username, email, password) {
            try {
                // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
                if (users.find(user => user.username === username)) {
                    showResultModal('é”™è¯¯', 'ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·å', 'error');
                    return false;
                }
                
                // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
                if (users.find(user => user.email === email)) {
                    showResultModal('é”™è¯¯', 'é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–é‚®ç®±', 'error');
                    return false;
                }
                
                // åˆ›å»ºæ–°ç”¨æˆ·
                const newUser = {
                    id: Date.now(),
                    username: username,
                    email: email,
                    password: password,
                    letters: [],
                    hugsReceived: [],
                    flowers: 0,
                    lastLoginDate: null
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                // è‡ªåŠ¨ç™»å½•
                currentUser = newUser;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserArea();
                
                showResultModal('æˆåŠŸ', 'æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿æ¥åˆ°å¿ƒçµæ ‘æ´', 'success');
                hideModal('registerModal');
                return true;
            } catch (error) {
                console.error('æ³¨å†Œç”¨æˆ·å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                return false;
            }
        }
        
        // ç™»å½•ç”¨æˆ·
        function loginUser(username, password) {
            try {
                // æŸ¥æ‰¾ç”¨æˆ·
                const user = users.find(user => user.username === username && user.password === password);
                
                if (!user) {
                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é‡å¤ç”¨æˆ·åçš„æƒ…å†µ
                    const usersWithSameName = users.filter(u => u.username === username);
                    
                    if (usersWithSameName.length > 0) {
                        // æœ‰é‡å¤ç”¨æˆ·åï¼Œä½†å¯†ç ä¸åŒ¹é…
                        showResultModal('é”™è¯¯', 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
                        
                        // æ·»åŠ é”™è¯¯æŠ–åŠ¨æ•ˆæœ
                        const loginForm = document.getElementById('loginForm');
                        loginForm.classList.add('error-shake');
                        setTimeout(() => {
                            loginForm.classList.remove('error-shake');
                        }, 500);
                    } else {
                        // ç”¨æˆ·åä¸å­˜åœ¨
                        showResultModal('é”™è¯¯', 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
                        
                        // æ·»åŠ é”™è¯¯æŠ–åŠ¨æ•ˆæœ
                        const loginForm = document.getElementById('loginForm');
                        loginForm.classList.add('error-shake');
                        setTimeout(() => {
                            loginForm.classList.remove('error-shake');
                        }, 500);
                    }
                    return false;
                }
                
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserArea();
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æœªè¯»æ‹¥æŠ±é€šçŸ¥
                const newHugCount = checkForNewHugs();
                
                // æ˜¾ç¤ºæ¯æ—¥ç»Ÿè®¡ä¿¡æ¯
                showDailyStats();
                
                // å¦‚æœæœ‰æ–°æ‹¥æŠ±ï¼Œæ˜¾ç¤ºæé†’
                if (newHugCount > 0) {
                    const newHugReminder = document.getElementById('newHugReminder');
                    const newHugReminderText = document.getElementById('newHugReminderText');
                    newHugReminderText.textContent = `ä½ æœ‰ ${newHugCount} ä¸ªæ–°çš„æ‹¥æŠ±ï¼`;
                    newHugReminder.classList.remove('hidden');
                }
                
                showResultModal('æˆåŠŸ', 'ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥', 'success');
                hideModal('loginModal');
                return true;
            } catch (error) {
                console.error('ç™»å½•ç”¨æˆ·å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                return false;
            }
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            try {
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUserArea();
                showPage('homePage');
                showResultModal('æˆåŠŸ', 'å·²é€€å‡ºç™»å½•', 'success');
            } catch (error) {
                console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // é‡ç½®æ•°æ®
        function resetData() {
            try {
                // æ¸…ç©ºlocalStorage
                localStorage.removeItem('users');
                localStorage.removeItem('letters');
                localStorage.removeItem('currentUser');
                
                // æ¸…é™¤æ‰€æœ‰æ‹¥æŠ±é€šçŸ¥
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('hugNotification_')) {
                        localStorage.removeItem(key);
                        i--; // å› ä¸ºåˆ é™¤äº†ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ç´¢å¼•éœ€è¦å‡1
                    }
                }
                
                // é‡æ–°åˆå§‹åŒ–æ•°æ®
                initData();
                
                // é‡ç½®é¡µé¢çŠ¶æ€
                showPage('homePage');
                hideModal('resetDataModal');
                showResultModal('æˆåŠŸ', 'æ•°æ®å·²é‡ç½®ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€', 'success');
            } catch (error) {
                console.error('é‡ç½®æ•°æ®å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'é‡ç½®æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        // æäº¤ä¿¡ä»¶
        function submitLetter(title, content) {
            try {
                if (!currentUser) {
                    alert('è¯·å…ˆç™»å½•æ‰èƒ½æäº¤ä¿¡ä»¶');
                    showModal('loginModal');
                    return false;
                }
                
                const newLetter = {
                    id: Date.now(),
                    title: title || 'æ— é¢˜',
                    content: content,
                    authorId: currentUser.id,
                    date: new Date().toISOString().split('T')[0],
                    hugs: 0
                };
                
                letters.push(newLetter);
                localStorage.setItem('letters', JSON.stringify(letters));
                
                // å°†ä¿¡ä»¶æ·»åŠ åˆ°ç”¨æˆ·çš„ä¿¡ä»¶åˆ—è¡¨
                const userIndex = users.findIndex(user => user.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].letters.push(newLetter.id);
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                showResultModal('æˆåŠŸ', 'ä¿¡ä»¶å·²æŠ•å…¥æ ‘æ´ï¼', 'success');
                showPage('å€¾è¯‰Page');
                return true;
            } catch (error) {
                console.error('æäº¤ä¿¡ä»¶å¤±è´¥:', error);
                showResultModal('é”™è¯¯', 'æäº¤ä¿¡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                return false;
            }
        }
        
        // åˆ›å»ºæ¼‚æµ®ä¿¡ä»¶æ•ˆæœ
        function createFloatingLetters() {
            try {
                const floatingLetters = document.getElementById('floatingLetters');
                floatingLetters.innerHTML = '';
                
                for (let i = 0; i < 10; i++) {
                    const letter = document.createElement('div');
                    letter.className = 'absolute letter-fall';
                    letter.style.left = Math.random() * 100 + '%';
                    letter.style.animationDelay = Math.random() * 5 + 's';
                    letter.style.animationDuration = (Math.random() * 3 + 5) + 's';
                    letter.style.opacity = Math.random() * 0.5 + 0.2;
                    
                    // éšæœºé€‰æ‹©ä¿¡ä»¶å›¾ç‰‡
                    const letterImages = [
                        'https://aka.doubaocdn.com/s/hDii1w0ZA2',
                        'https://aka.doubaocdn.com/s/y4NV1w0ZA3',
                        'https://aka.doubaocdn.com/s/meUU1w0ZA3'
                    ];
                    
                    letter.innerHTML = `
                        <img src="${letterImages[Math.floor(Math.random() * letterImages.length)]}" 
                             alt="æ¼‚æµ®ä¿¡ä»¶" 
                             class="w-16 h-16 object-contain transform rotate-${Math.random() * 360}">
                    `;
                    
                    floatingLetters.appendChild(letter);
                }
            } catch (error) {
                console.error('åˆ›å»ºæ¼‚æµ®ä¿¡ä»¶æ•ˆæœå¤±è´¥:', error);
            }
        }
        
        // æ ‘ç‚¹å‡»äº‹ä»¶å¤„ç†
        function handleTreeClick() {
            if (!checkLoginStatus()) {
                return;
            }
            
            // æ˜¾ç¤ºæš—åŒ–é®ç½©
            const darkenOverlay = document.getElementById('darkenOverlay');
            darkenOverlay.classList.add('darken-background');
            darkenOverlay.style.pointerEvents = 'auto';
            
            // æ˜¾ç¤ºæ”¾å¤§çš„æ ‘æ´æŒ‰é’®
            const treeholeButton = document.getElementById('treeholeButton');
            treeholeButton.classList.add('treehole-zoom');
            treeholeButton.style.opacity = '1';
            treeholeButton.style.pointerEvents = 'auto';
            
            // éšè—æ ‘ç‚¹å‡»åŒºåŸŸ
            document.getElementById('treeClickArea').style.pointerEvents = 'none';
        }
        
        // æ”¾å¤§æ ‘æ´æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        function handleTreeholeButtonClick() {
            // éšè—æ ‘æ´æŒ‰é’®å’Œé®ç½©
            const treeholeButton = document.getElementById('treeholeButton');
            const darkenOverlay = document.getElementById('darkenOverlay');
            
            treeholeButton.classList.remove('treehole-zoom');
            treeholeButton.style.opacity = '0';
            treeholeButton.style.pointerEvents = 'none';
            
            darkenOverlay.classList.remove('darken-background');
            darkenOverlay.style.pointerEvents = 'none';
            
            // æ¢å¤æ ‘ç‚¹å‡»åŒºåŸŸ
            document.getElementById('treeClickArea').style.pointerEvents = 'auto';
            
            // è¿›å…¥å€¾è¯‰é¡µé¢
            showPage('å€¾è¯‰Page');
        }
        
        // åˆå§‹åŒ–æµè§ˆå™¨é€šçŸ¥æƒé™
        function initNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission();
                }
            }
        }
        
        // ç›‘å¬å­˜å‚¨å˜åŒ–ï¼Œå®ç°è·¨æ ‡ç­¾é¡µé€šä¿¡
        window.addEventListener('storage', function(e) {
            if (e.key.startsWith('hugNotification_') && e.newValue) {
                const userId = e.key.split('_')[1];
                if (currentUser && currentUser.id == userId) {
                    checkForNewHugs();
                }
            }
        });
        
        // å®šæœŸæ£€æŸ¥æ–°æ‹¥æŠ±
        setInterval(checkForNewHugs, 3000);
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ•°æ®
            initData();
            
            // åˆå§‹åŒ–é€šçŸ¥æƒé™
            initNotificationPermission();
            
            // æ ‘ç‚¹å‡»äº‹ä»¶
            document.getElementById('treeClickArea').addEventListener('click', handleTreeClick);
            
            // æ”¾å¤§æ ‘æ´æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('treeholeButton').addEventListener('click', handleTreeholeButtonClick);
            
            // å†™ä¿¡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('writeLetterBtn').addEventListener('click', function() {
                showPage('writeLetterPage');
            });
            
            // çª¥æ¢æ ‘æ´æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('exploreHoleBtn').addEventListener('click', function() {
                showPage('treeholeInsidePage');
                renderLettersGrid();
                createFloatingLetters();
            });
            
            // è¿”å›é¦–é¡µæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('backToHomeBtn').addEventListener('click', function() {
                showPage('homePage');
            });
            
            // è¿”å›å€¾è¯‰é¡µé¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('backToå€¾è¯‰Btn').addEventListener('click', function() {
                showPage('å€¾è¯‰Page');
            });
            
            // ç¦»å¼€æ ‘æ´æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('leaveTreeholeBtn').addEventListener('click', function() {
                showPage('å€¾è¯‰Page');
            });
            
            // åˆ·æ–°ä¿¡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('refreshLettersBtn').addEventListener('click', function() {
                renderLettersGrid();
            });
            
            // å…³é—­æ¨¡æ€æ¡†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('closeModalBtn').addEventListener('click', function() {
                hideModal('letterModal');
            });
            
            // å‘é€æ‹¥æŠ±æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('sendHugBtn').addEventListener('click', function() {
                const letterId = this.dataset.letterId;
                const authorId = this.dataset.authorId;
                sendHug(letterId, authorId);
            });
            
            // ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('loginBtn').addEventListener('click', function() {
                showModal('loginModal');
            });
            
            // æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('registerBtn').addEventListener('click', function() {
                showModal('registerModal');
            });
            
            // å…³é—­ç™»å½•æ¨¡æ€æ¡†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('closeLoginModal').addEventListener('click', function() {
                hideModal('loginModal');
            });
            
            // å…³é—­æ³¨å†Œæ¨¡æ€æ¡†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('closeRegisterModal').addEventListener('click', function() {
                hideModal('registerModal');
            });
            
            // å…³é—­ç™»å½•æç¤ºæ¨¡æ€æ¡†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('closeLoginRequiredModal').addEventListener('click', function() {
                hideModal('loginRequiredModal');
            });
            
            // å»ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('goToLoginBtn').addEventListener('click', function() {
                hideModal('loginRequiredModal');
                showModal('loginModal');
            });
            
            // åˆ‡æ¢åˆ°æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('switchToRegister').addEventListener('click', function() {
                hideModal('loginModal');
                showModal('registerModal');
            });
            
            // åˆ‡æ¢åˆ°ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('switchToLogin').addEventListener('click', function() {
                hideModal('registerModal');
                showModal('loginModal');
            });
            
            // ç™»å½•è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                loginUser(username, password);
            });
            
            // æ³¨å†Œè¡¨å•æäº¤äº‹ä»¶
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('registerUsername').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (password !== confirmPassword) {
                    showResultModal('é”™è¯¯', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                    return;
                }
                
                registerUser(username, email, password);
            });
            
            // ä¿¡ä»¶è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('letterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('letterTitle').value;
                const content = document.getElementById('letterContent').value;
                
                if (content.trim() === '') {
                    showResultModal('é”™è¯¯', 'ä¿¡ä»¶å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
                    return;
                }
                
                submitLetter(title, content);
                
                // æ¸…ç©ºè¡¨å•
                this.reset();
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                backdrop.addEventListener('click', function() {
                    const modal = this.parentElement;
                    modal.classList.add('hidden');
                });
            });
            
            // ç‚¹å‡»æš—åŒ–é®ç½©å…³é—­æ ‘æ´æŒ‰é’®
            document.getElementById('darkenOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    const treeholeButton = document.getElementById('treeholeButton');
                    
                    treeholeButton.classList.remove('treehole-zoom');
                    treeholeButton.style.opacity = '0';
                    treeholeButton.style.pointerEvents = 'none';
                    
                    this.classList.remove('darken-background');
                    this.style.pointerEvents = 'none';
                    
                    // æ¢å¤æ ‘ç‚¹å‡»åŒºåŸŸ
                    document.getElementById('treeClickArea').style.pointerEvents = 'auto';
                }
            });
            
            // æ‹¥æŠ±é€šçŸ¥ç‚¹å‡»éšè—
            document.getElementById('hugNotification').addEventListener('click', function() {
                this.classList.add('hidden');
            });
            
            // å®æ—¶æ‹¥æŠ±é€šçŸ¥ç‚¹å‡»éšè—
            document.getElementById('realTimeHugNotification').addEventListener('click', function() {
                this.classList.add('hidden');
            });
            
            // æ‹¥æŠ±ç»Ÿè®¡é€šçŸ¥ç‚¹å‡»éšè—
            document.getElementById('hugCountNotification').addEventListener('click', function() {
                this.classList.add('hidden');
            });
            
            // é²œèŠ±ç»Ÿè®¡é€šçŸ¥ç‚¹å‡»éšè—
            document.getElementById('flowerCountNotification').addEventListener('click', function() {
                this.classList.add('hidden');
            });
            
            // æ–°æ‹¥æŠ±æé†’ç‚¹å‡»éšè—
            document.getElementById('newHugReminder').addEventListener('click', function() {
                this.classList.add('hidden');
            });
            
            // é‡ç½®æ•°æ®ç›¸å…³äº‹ä»¶
            document.getElementById('resetDataBtn').addEventListener('click', function() {
                showModal('resetDataModal');
            });
            
            document.getElementById('cancelResetBtn').addEventListener('click', function() {
                hideModal('resetDataModal');
            });
            
            document.getElementById('confirmResetBtn').addEventListener('click', function() {
                resetData();
            });
            
            // ç»“æœæ¨¡æ€æ¡†å…³é—­äº‹ä»¶
            document.getElementById('closeResultModal').addEventListener('click', function() {
                hideModal('resultModal');
            });
        });
    </script>


</body></html>